#!@TERMUX_PREFIX@/bin/bash
set -e -u

SCRIPTNAME=termux-accessibility
show_usage() {
    echo "Usage: $SCRIPTNAME options"
    echo 'Options:'
    echo 'dump: returns UI XML as `adb` `uiautomator dump`'
    echo 'click x y: clicks at the given location'
    echo 'type toType: types the given string'
    echo 'global-action globalAction: performs the given global action'
    exit 0
}

USAGE_REGEX='^dump|click [0-9]+ [0-9]+$|type .+|global-action .+'
if ! [[ $@ =~ $USAGE_REGEX ]]; then
    show_usage
fi

if [ "$1" == dump ]; then
    ARGS="--esn dump"
elif [ "$1" == click ]; then
    ARGS="--esn click --ei x $2 --ei y $3"
elif [ "$1" == type ]; then
    ARGS="--es type $2"
elif [ "$1" == global-action ]; then
    ARGS="--es global-action $2"
fi

@TERMUX_PREFIX@/libexec/termux-api Accessibility $ARGS
